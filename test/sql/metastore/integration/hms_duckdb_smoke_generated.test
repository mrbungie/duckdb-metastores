# name: hms_duckdb_smoke_generated
# description: generated HMS + DuckDB integration checks
# group: [sql]

require metastore

statement ok
CREATE TEMP TABLE duckdb_smoke(i INTEGER);

statement ok
INSERT INTO duckdb_smoke VALUES (7), (11);

query I
SELECT SUM(i) FROM duckdb_smoke;
----
18

statement ok
ATTACH 'thrift://127.0.0.1:9083' AS hms (TYPE metastore);

query II
EXPLAIN SELECT * FROM hms.metastore_ci.fixture_tbl_1_partitioned WHERE year='2023';
----
logical_plan	<REGEX>:.*metastore_read.*

query I
SELECT (SELECT COUNT(*) FROM metastore_scan('hms', 'metastore_ci', 'fixture_tbl_1_partitioned')) + (SELECT COUNT(*) FROM metastore_scan('hms', 'metastore_ci', 'fixture_tbl_2')) + (SELECT COUNT(*) FROM metastore_scan('hms', 'metastore_ci', 'fixture_tbl_3')) + (SELECT COUNT(*) FROM metastore_scan('hms', 'metastore_ci', 'fixture_tbl_4')) + (SELECT COUNT(*) FROM metastore_scan('hms', 'metastore_ci', 'fixture_tbl_5'));
----
5

query I
SELECT COUNT(*) FROM (SELECT * FROM metastore_scan('hms', 'metastore_ci', 'fixture_tbl_1') WHERE lower(format) = 'csv' UNION ALL SELECT * FROM metastore_scan('hms', 'metastore_ci', 'fixture_tbl_2') WHERE lower(format) = 'csv' UNION ALL SELECT * FROM metastore_scan('hms', 'metastore_ci', 'fixture_tbl_3') WHERE lower(format) = 'csv' UNION ALL SELECT * FROM metastore_scan('hms', 'metastore_ci', 'fixture_tbl_4') WHERE lower(format) = 'csv' UNION ALL SELECT * FROM metastore_scan('hms', 'metastore_ci', 'fixture_tbl_5') WHERE lower(format) = 'csv') t;
----
5

query I
SELECT COUNT(*) FROM hms.metastore_ci.fixture_tbl_1;
----
1

query I
SELECT SUM(id) FROM hms.metastore_ci.fixture_tbl_1;
----
1

query T
SELECT value FROM hms.metastore_ci.fixture_tbl_1 WHERE id = 1;
----
v1

statement error
INSERT INTO hms.metastore_ci.fixture_tbl_1 VALUES (100, 'duckdb_write');
----
