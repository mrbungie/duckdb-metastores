# name: test/sql/metastore/integration/hms_pushdown.test
# description: end to end test of partition pushdown against a live HMS server
# group: [metastore]

require metastore

test-env HMS_LOCAL_ENDPOINT 127.0.0.1:9083


# Ensure data was seeded
statement ok
ATTACH 'thrift://${HMS_LOCAL_ENDPOINT}' AS hms (TYPE metastore);

# Test basic pushdown
query II
SELECT year, value FROM hms.metastore_ci.fixture_tbl_partitioned WHERE year='2023';
----
2023	old

# Test OR condition
query II
SELECT year, value FROM hms.metastore_ci.fixture_tbl_partitioned WHERE year='2023' OR year='2024' ORDER BY year;
----
2023	old
2024	new

# Test function expression (handled locally by DuckDB)
query II
SELECT year, value FROM hms.metastore_ci.fixture_tbl_partitioned WHERE CAST(year AS INT) > 2023;
----
2024	new
